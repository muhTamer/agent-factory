{
  "version": "1.0",
  "vertical": "fintech",
  "modes": {
    "dry_run": true
  },
  "paths": {
    "base_dir": "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace",
    "policy_pack": "spec/base_policy_pack.yaml"
  },
  "agents": [
    {
      "id": "guardrails",
      "type": "guardrails",
      "config": "spec/base_policy_pack.yaml"
    },
    {
      "id": "faq_rag",
      "type": "autogen",
      "blueprint": "knowledge_rag",
      "status": "ready",
      "inputs": {
        "docs": [
          "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace\\BankFAQs.csv",
          "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace\\refunds_policy.yaml"
        ]
      },
      "blueprint_meta": {
        "agent_kind": "knowledge_rag",
        "description": "Retrieval-augmented responder for customer-facing FAQs and policy-aware answers. Uses the bank FAQ knowledge base and refunds policy to answer customer questions, cite policy when relevant, and surface recommended next steps.",
        "capabilities": [
          "retrieve_faq_answers",
          "cite_policy_sections",
          "summarize_policy_for_customers",
          "detect_refund_related_queries",
          "flag_for_escalation_when_policy_unsure"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "refunds_workflow",
      "type": "autogen",
      "blueprint": "workflow_runner",
      "status": "ready",
      "inputs": {
        "workflow_spec": {
          "id": "refunds_handling_fsm_v1",
          "description": "FSM to handle customer refund requests in accordance with refunds_policy.yaml. Evaluates identity verification, eligibility rules, and amount limits, then routes to approval, decline, or escalation.",
          "engine": "fsm",
          "slots": {
            "customer_id": {
              "type": "string",
              "required": true,
              "description": "Unique customer identifier"
            },
            "transaction_id": {
              "type": "string",
              "required": true,
              "description": "Identifier for the payment/transaction to refund"
            },
            "refund_amount": {
              "type": "number",
              "required": true,
              "description": "Requested refund amount"
            },
            "currency": {
              "type": "string",
              "required": false,
              "description": "Currency of the refund_amount"
            },
            "reason": {
              "type": "string",
              "required": false,
              "description": "Customer-provided reason for refund"
            },
            "verified_identity": {
              "type": "boolean",
              "required": false,
              "description": "Result of identity verification"
            },
            "eligible": {
              "type": "boolean",
              "required": false,
              "description": "Result of eligibility evaluation against policy"
            },
            "policy_limit": {
              "type": "number",
              "required": false,
              "description": "Maximum refundable amount per policy (populated from refunds_policy.yaml)"
            },
            "escalate": {
              "type": "boolean",
              "required": false,
              "description": "Whether the case requires human escalation"
            }
          },
          "states": {
            "start": {
              "description": "Entry point when a refund request is received.",
              "on_enter": "Record request metadata and validate required slots (customer_id, transaction_id, refund_amount).",
              "on": {
                "begin": "verify_identity"
              }
            },
            "verify_identity": {
              "description": "Ensure the requester identity is verified before policy checks.",
              "on_enter": "Invoke identity verification (tool operator) or prompt for verification evidence.",
              "on": {
                "verified": "check_eligibility",
                "unverified": "escalate_identity"
              },
              "action": "call_verify_identity"
            },
            "escalate_identity": {
              "description": "Identity verification failed or could not be completed; create escalation/ticket for manual follow-up.",
              "on_enter": "Create escalation ticket and mark for human follow-up.",
              "on": {
                "ticket_created": "end_escalation_identity"
              },
              "action": "create_identity_escalation"
            },
            "end_escalation_identity": {
              "description": "Terminal state after identity escalation has been created.",
              "on_enter": "Provide ticket reference and next steps to agent or customer.",
              "terminal": true
            },
            "check_eligibility": {
              "description": "Evaluate the refunds_policy.yaml rules (eligibility, time windows, reason restrictions, AML/KYC constraints).",
              "on_enter": "Evaluate policy rules and set slot 'eligible' true/false.",
              "on": {
                "eligible": "check_amount_limit",
                "ineligible": "decline"
              },
              "action": "evaluate_refunds_policy"
            },
            "check_amount_limit": {
              "description": "Compare requested refund_amount against policy_limit and cumulative refunds rules.",
              "on_enter": "Determine whether refund_amount <= policy_limit and whether additional approvals are required.",
              "on": {
                "within_limit": "approve",
                "over_limit": "escalate_human"
              },
              "action": "compare_amount_with_policy_limit"
            },
            "approve": {
              "description": "Approved path: initiate refund and notify customer.",
              "on_enter": "Trigger refund execution (tool operator) and prepare notification text with policy citation.",
              "on": {
                "refund_initiated": "notify_customer",
                "refund_failed": "escalate_human"
              },
              "action": "initiate_refund_execution"
            },
            "notify_customer": {
              "description": "Notify customer of approval and update case status.",
              "on_enter": "Send approval notification, update ticket, and include policy reference and expected timeline.",
              "on": {
                "notified": "end_success"
              },
              "action": "notify_and_update_ticket"
            },
            "decline": {
              "description": "Declined path: prepare a decline notification with clear policy reason and next steps (appeal/escalation).",
              "on_enter": "Produce decline message citing the relevant policy sections and record case closure reason.",
              "on": {
                "notify_done": "end_decline"
              },
              "terminal": false,
              "action": "prepare_decline_notice"
            },
            "escalate_human": {
              "description": "Amount or complexity requires human review/approval; create escalation ticket and handoff.",
              "on_enter": "Create escalation ticket, attach evaluation summary and policy excerpts, and handoff to specialist queue.",
              "on": {
                "ticket_created": "end_escalation"
              },
              "action": "create_escalation_ticket_and_handoff"
            },
            "end_success": {
              "description": "Terminal: refund approved and customer notified.",
              "terminal": true
            },
            "end_decline": {
              "description": "Terminal: decline communicated and case closed.",
              "terminal": true
            },
            "end_escalation": {
              "description": "Terminal: escalation ticket created and case routed for manual handling.",
              "terminal": true
            }
          },
          "initial_state": "start"
        }
      },
      "blueprint_meta": {
        "agent_kind": "workflow_runner",
        "description": "Finite-state workflow orchestrator for refunds: verifies identity, evaluates eligibility against refunds_policy.yaml, checks amount limits, and routes to approve/decline/escalate outcomes. Designed to produce an auditable decision and trigger tool operators for verification, ticketing, and refund execution.",
        "capabilities": [
          "orchestrate_refund_decision_process",
          "collect_required_fields",
          "evaluate_policy_rules",
          "determine_approval_or_escalation",
          "emit_actionable_next_steps_for_tools_or_humans"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "identity_verifier",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "verify_identity"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Tool operator that performs identity verification checks (KYC/PII validation) when invoked by workflows. Returns verification result and a short audit trail.",
        "capabilities": [
          "perform_identity_checks",
          "return_verification_result",
          "generate_verification_audit_ref"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "refund_executor",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "initiate_refund"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Tool operator that executes refund transactions via the payments/refunds tool. Intended to be called only after policy approval and verification steps.",
        "capabilities": [
          "initiate_payment_refund",
          "return_refund_transaction_id",
          "report_refund_status"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "ticket_creator",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "create_ticket"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Tool operator that creates and updates case/ticketing records for escalations, identity follow-ups, or manual approvals.",
        "capabilities": [
          "create_escalation_ticket",
          "attach_policy_excerpts",
          "update_ticket_status"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    }
  ],
  "tools": [
    {
      "id": "ticketing",
      "type": "dummy",
      "base_url": null
    }
  ],
  "plan_preview": {
    "missing_docs": [
      "<UPLOAD:refunds_playbook>",
      "<UPLOAD:payments_api_spec>",
      "<UPLOAD:case_management_procedure>"
    ],
    "warnings": [
      "The refunds_workflow references policy evaluation and tool operators but does not include an operational refunds playbook or concrete payments API spec; full end-to-end automation requires the documents listed in missing_docs.",
      "Workflows that execute monetary actions must include explicit approval thresholds and audit logging in the playbook; ensure human approval steps are configured for amounts over policy limits.",
      "Runtime guardrails (PII handling, policy citation, and escalation rules) must be enforced by the execution spine; agents should not bypass them."
    ],
    "rationale": "Mapped existing plan entities into executable blueprints: the customer-facing FAQ RAG becomes a knowledge_rag consuming the BankFAQs.csv and refunds_policy.yaml; the Refunds Workflow is modeled as an FSM (workflow_runner) capturing identity verification, policy-based eligibility checks, amount-limit checks, and outcomes (approve/decline/escalate). To enable the workflow to act, three tool_operator agents were added for identity verification, refund execution, and ticket creation, referencing the available tool names. Missing documents were listed where the workflow needs operational detail (refunds playbook, payments API spec, case management procedure). The FSM states and slots align with the summarized refunds_policy.yaml and the existing plan notes so the factory can instantiate agents and wire tool operators to the workflow at runtime."
  }
}