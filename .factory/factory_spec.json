{
  "version": "1.0",
  "vertical": "fintech",
  "modes": {
    "dry_run": true
  },
  "paths": {
    "base_dir": "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace",
    "policy_pack": "spec/base_policy_pack.yaml"
  },
  "agents": [
    {
      "id": "guardrails",
      "type": "guardrails",
      "config": "spec/base_policy_pack.yaml"
    },
    {
      "id": "kb_rag",
      "type": "autogen",
      "blueprint": "knowledge_rag",
      "status": "ready",
      "inputs": {
        "docs": [
          "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace\\BankFAQs.csv",
          "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace\\refunds_policy.yaml"
        ]
      },
      "blueprint_meta": {
        "agent_kind": "knowledge_rag",
        "description": "Retrieval-augmented generation agent that answers customer-facing banking questions using the Bank FAQs and consults the refunds policy for refund/compliance questions. Provides citations to the source documents when policy assertions are made and flags regulated cases for workflow handoff.",
        "capabilities": [
          "answer_customer_faqs",
          "cite_source_documents",
          "detect_refund_or_regulated_intent",
          "summarize_policy_clauses",
          "handoff_to_refund_workflow"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "refunds_workflow",
      "type": "autogen",
      "blueprint": "workflow_runner",
      "status": "ready",
      "inputs": {
        "workflow_spec": {
          "id": "refunds_fsm_v1",
          "description": "FSM to handle customer refund requests including eligibility checks, info collection, identity verification, refund execution, and escalation.",
          "engine": "fsm",
          "slots": {
            "customer_id": {
              "type": "string",
              "required": true,
              "description": "Unique customer identifier used to look up accounts and KYC status."
            },
            "transaction_id": {
              "type": "string",
              "required": true,
              "description": "Identifier of the transaction for which a refund is requested."
            },
            "amount": {
              "type": "number",
              "required": true,
              "description": "Monetary amount requested for refund."
            },
            "currency": {
              "type": "string",
              "required": false,
              "description": "Currency of the refund amount (optional if implicit)."
            },
            "reason": {
              "type": "string",
              "required": true,
              "description": "Customer-provided reason for the refund request."
            },
            "evidence_provided": {
              "type": "boolean",
              "required": false,
              "description": "Whether customer attached supporting evidence (receipts, screenshots)."
            },
            "supervisor_approval": {
              "type": "boolean",
              "required": false,
              "description": "Whether a supervisor has approved the refund (set by escalation)."
            },
            "eligibility": {
              "type": "string",
              "required": false,
              "description": "Determined eligibility status: 'eligible' or 'ineligible'."
            }
          },
          "states": {
            "start": {
              "description": "Entry point for a refund request.",
              "on_enter": "Receive refund request and validate presence of required slots (customer_id, transaction_id, amount, reason).",
              "on": {
                "evaluate": "check_eligibility",
                "cancel": "cancel"
              },
              "terminal": false
            },
            "check_eligibility": {
              "description": "Assess refund eligibility using refunds_policy.yaml and transaction/customer data.",
              "on_enter": "Evaluate policy rules (eligibility windows, limits, AML/KYC constraints) and set 'eligibility' slot to 'eligible' or 'ineligible'.",
              "action": "evaluate_refund_policy",
              "on": {
                "eligible": "gather_info",
                "ineligible": "deny_refund",
                "needs_escalation": "escalate_supervisor"
              },
              "terminal": false
            },
            "gather_info": {
              "description": "Request or validate any missing customer information or evidence needed to process the refund.",
              "on_enter": "Ask customer for missing documents or clarifications; use Bank FAQs for common guidance on acceptable documents.",
              "action": "collect_customer_info",
              "on": {
                "info_provided": "verify_identity",
                "info_missing": "create_ticket",
                "cancel": "cancel"
              },
              "terminal": false
            },
            "verify_identity": {
              "description": "Run identity verification checks per KYC/AML requirements.",
              "on_enter": "Invoke identity verification tool to confirm customer identity and KYC status.",
              "action": "verify_identity",
              "on": {
                "verified": "process_refund",
                "fraud_suspected": "escalate_fraud",
                "unverified": "escalate_supervisor"
              },
              "terminal": false
            },
            "process_refund": {
              "description": "Attempt to execute the refund through the payments system.",
              "on_enter": "Call payment tool to initiate refund and capture response (success/failure).",
              "action": "initiate_refund",
              "on": {
                "processed": "complete",
                "failed": "create_ticket"
              },
              "terminal": false
            },
            "escalate_supervisor": {
              "description": "Escalate the case to a supervisor for manual approval when policy requires it or verification fails.",
              "on_enter": "Create a supervisor escalation ticket including all evidence and policy rationale.",
              "action": "create_ticket",
              "on": {
                "escalated": "await_supervisor_decision"
              },
              "terminal": false
            },
            "await_supervisor_decision": {
              "description": "Wait for supervisor decision and proceed based on approval or rejection.",
              "on_enter": "Pause workflow until supervisor updates 'supervisor_approval' slot.",
              "on": {
                "approved": "process_refund",
                "rejected": "deny_refund"
              },
              "terminal": false
            },
            "escalate_fraud": {
              "description": "Flag suspected fraud and open a high-priority investigation ticket.",
              "on_enter": "Open fraud investigation ticket and notify fraud operations team; do not initiate refund.",
              "action": "create_ticket",
              "terminal": true
            },
            "create_ticket": {
              "description": "Create a manual-handling ticket (CRM) for failed operations or missing info.",
              "on_enter": "Open ticket with context, attach evidence and assign to appropriate queue for manual resolution.",
              "action": "create_ticket",
              "terminal": true
            },
            "deny_refund": {
              "description": "Deny the refund request and inform the customer with policy rationale.",
              "on_enter": "Send denial notification to customer citing relevant policy clauses and next steps (if any).",
              "action": "notify_customer",
              "terminal": true
            },
            "complete": {
              "description": "Refund successfully completed and customer notified.",
              "on_enter": "Record completion, include transaction confirmation, and notify customer.",
              "action": "notify_customer",
              "terminal": true
            },
            "cancel": {
              "description": "Workflow cancelled by customer or system.",
              "on_enter": "Record cancellation and notify customer.",
              "terminal": true
            }
          },
          "initial_state": "start"
        }
      },
      "blueprint_meta": {
        "agent_kind": "workflow_runner",
        "description": "Finite-state workflow that orchestrates refund requests: assesses eligibility per refunds_policy.yaml, collects required customer information (guided by Bank FAQs), performs identity verification, initiates refunds when eligible, and escalates to supervisors or manual handling when required by policy or verification results.",
        "capabilities": [
          "evaluate_refund_eligibility",
          "collect_required_customer_info",
          "coordinate_identity_verification",
          "initiate_refund_execution",
          "create_escalation_ticket",
          "record_workflow_decision"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "verify_identity_operator",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "verify_identity"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Operator agent that uses the 'verify_identity' tool to perform KYC identity checks and return verification outcomes used by workflows.",
        "capabilities": [
          "perform_identity_checks",
          "return_verification_result",
          "flag_suspected_fraud",
          "log_verification_outcome"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "initiate_refund_operator",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "initiate_refund"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Operator agent that uses the 'initiate_refund' tool to execute refund payments and report success/failure and payment transaction identifiers.",
        "capabilities": [
          "execute_refund_payment",
          "validate_payment_response",
          "return_payment_transaction_id",
          "report_refund_failure_reasons"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "create_ticket_operator",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "create_ticket"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Operator agent that uses the 'create_ticket' tool to open CRM tickets for escalations, fraud investigations, and manual refund handling.",
        "capabilities": [
          "open_crm_ticket",
          "attach_evidence_to_ticket",
          "assign_ticket_to_queue",
          "return_ticket_identifier"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "lookup_customer_operator",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "lookup_customer"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Operator agent that uses the 'lookup_customer' tool to fetch customer profiles, account status and recent transactions to support eligibility evaluation.",
        "capabilities": [
          "fetch_customer_profile",
          "retrieve_account_status",
          "list_recent_transactions",
          "return_customer_attributes"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "request_router",
      "type": "autogen",
      "blueprint": "workflow_runner",
      "status": "ready",
      "inputs": {
        "workflow_spec": {
          "id": "request_router_fsm_v1",
          "description": "Classify incoming messages and route to the correct subsystem (KB RAG, Refunds Workflow, or human queue).",
          "engine": "fsm",
          "slots": {
            "incoming_text": {
              "type": "string",
              "required": true,
              "description": "Raw customer message to classify."
            },
            "detected_intent": {
              "type": "string",
              "required": false,
              "description": "Intent classification result: 'faq', 'refund', 'escalation', or 'other'."
            },
            "confidence": {
              "type": "number",
              "required": false,
              "description": "Confidence score for the classification (0-1)."
            }
          },
          "states": {
            "start": {
              "description": "Receive incoming customer message.",
              "on_enter": "Accept message and proceed to classification.",
              "on": {
                "classify": "classify_intent"
              },
              "terminal": false
            },
            "classify_intent": {
              "description": "Use lightweight rules and KB signals to classify message intent.",
              "on_enter": "Determine detected_intent using keywords, BankFAQs signals, and refunds policy indicators; set 'detected_intent' and 'confidence'.",
              "action": "classify_request",
              "on": {
                "faq": "route_to_kb",
                "refund": "route_to_refund_workflow",
                "escalation": "route_to_human",
                "other": "route_to_human"
              },
              "terminal": false
            },
            "route_to_kb": {
              "description": "Forward FAQ-type requests to the KB RAG agent.",
              "on_enter": "Invoke kb_rag to answer the customer or return suggested articles.",
              "action": "route:kb_rag",
              "terminal": true
            },
            "route_to_refund_workflow": {
              "description": "Forward refund requests to the refunds workflow for full processing.",
              "on_enter": "Initiate refunds_workflow with extracted slots (customer_id, transaction_id, amount, reason) where available.",
              "action": "route:refunds_workflow",
              "terminal": true
            },
            "route_to_human": {
              "description": "Route ambiguous or escalation requests to the human support queue.",
              "on_enter": "Create a human-handling ticket or handoff to human agent.",
              "action": "route:human_queue",
              "terminal": true
            }
          },
          "initial_state": "start"
        }
      },
      "blueprint_meta": {
        "agent_kind": "workflow_runner",
        "description": "Simple routing FSM that classifies incoming customer requests (FAQ, refund, escalation, other) and forwards them to the appropriate agent/flow (kb_rag, refunds_workflow, or human queue).",
        "capabilities": [
          "classify_incoming_request",
          "route_to_kb_rag",
          "route_to_refunds_workflow",
          "route_to_human_queue",
          "log_routing_decision"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    }
  ],
  "tools": [
    {
      "id": "ticketing",
      "type": "dummy",
      "base_url": null
    }
  ],
  "plan_preview": {
    "missing_docs": [
      "<UPLOAD:refunds_procedure>",
      "<UPLOAD:refunds_tool_spec>",
      "<UPLOAD:crm_integration_spec>",
      "<UPLOAD:supervisor_approval_workflow>"
    ],
    "warnings": [
      "The refunds_workflow references external operational procedures and integration points (payment API behavior, exact supervisor approval steps, CRM ticket fields). Those procedure/tool_spec documents are not provided; upload '<UPLOAD:refunds_procedure>' and '<UPLOAD:refunds_tool_spec>' to fully operationalize the workflow.",
      "Policy enforcement (AML/KYC, PII handling) should be applied at runtime as guardrails. A runtime guardrails configuration is required but is intentionally not included as an agent blueprint per factory rules.",
      "The workflow uses actions named to match available tools (verify_identity, initiate_refund, create_ticket, lookup_customer). Ensure those tool integrations exist and are authorized before connecting the workflow to production systems."
    ],
    "rationale": "Provided blueprints implement the operational components described in the existing plan while adhering to the factory's required agent_kinds. A knowledge_rag agent (kb_rag) uses the Bank FAQs and refunds policy to answer customer queries and detect refund/regulatory intent. A refunds_workflow workflow_runner FSM encodes the primary refund orchestration steps (eligibility check, info collection, identity verification, refund execution, and escalation). Tool_operator agents are included for the concrete external operations referenced by the workflow (verify_identity, initiate_refund, create_ticket, lookup_customer). The router is implemented as a lightweight FSM workflow_runner to classify and forward incoming requests. Missing operational procedure and tool specification documents are listed as placeholders so the factory can attach them and make the workflow fully executable in an integrated environment."
  }
}