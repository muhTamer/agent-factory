{
  "version": "1.0",
  "vertical": "fintech",
  "modes": {
    "dry_run": true
  },
  "paths": {
    "base_dir": "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace",
    "policy_pack": "spec/base_policy_pack.yaml"
  },
  "agents": [
    {
      "id": "guardrails",
      "type": "guardrails",
      "config": "spec/base_policy_pack.yaml"
    },
    {
      "id": "customer_faq_rag",
      "type": "autogen",
      "blueprint": "knowledge_rag",
      "status": "ready",
      "inputs": {
        "docs": [
          "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace\\BankFAQs.csv",
          "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace\\refunds_policy.yaml"
        ]
      },
      "blueprint_meta": {
        "agent_kind": "knowledge_rag",
        "description": "Retrieval-augmented agent that answers customer questions about account rules, KYC, transfers, and refunds by retrieving from the Bank FAQs and citing the refunds policy when relevant.",
        "capabilities": [
          "answer_faqs",
          "cite_sources",
          "policy_aware_responses",
          "multi_turn_clarification"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "refunds_policy_rag",
      "type": "autogen",
      "blueprint": "knowledge_rag",
      "status": "ready",
      "inputs": {
        "docs": [
          "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace\\refunds_policy.yaml"
        ]
      },
      "blueprint_meta": {
        "agent_kind": "knowledge_rag",
        "description": "Policy-focused retrieval agent that interprets the refunds policy, answers compliance questions, and validates refund eligibility rules for other agents or human reviewers.",
        "capabilities": [
          "interpret_policy",
          "validate_refund_decisions",
          "cite_policy_sections",
          "explain_policy_rationale"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "refunds_workflow_runner",
      "type": "autogen",
      "blueprint": "workflow_runner",
      "status": "ready",
      "inputs": {
        "workflow_spec": {
          "id": "refunds_fsm_v1",
          "description": "FSM to manage refund requests from submission through policy checks, approval, initiation, and closure or escalation.",
          "engine": "fsm",
          "slots": {
            "customer_id": {
              "type": "string",
              "required": true,
              "description": "Unique customer identifier"
            },
            "order_id": {
              "type": "string",
              "required": true,
              "description": "Order or transaction identifier for which refund is requested"
            },
            "amount_requested": {
              "type": "number",
              "required": true,
              "description": "Amount the customer requested to be refunded"
            },
            "transaction_id": {
              "type": "string",
              "required": false,
              "description": "Original payment transaction id if available"
            },
            "reason": {
              "type": "string",
              "required": false,
              "description": "Customer-provided reason for the refund"
            },
            "kyc_verified": {
              "type": "boolean",
              "required": false,
              "description": "Whether customer's identity/KYC has been verified"
            },
            "refund_amount": {
              "type": "number",
              "required": false,
              "description": "Calculated refundable amount after applying policy rules"
            },
            "approval_required": {
              "type": "boolean",
              "required": false,
              "description": "Indicates if human approval is needed for the computed refund"
            },
            "decision_notes": {
              "type": "string",
              "required": false,
              "description": "Notes capturing rationale or policy citations used for decisions"
            }
          },
          "states": {
            "start": {
              "description": "Initial state after a refund request is received. Validate presence of required slots and move to eligibility_check.",
              "on_enter": "Validate required inputs (customer_id, order_id, amount_requested). If missing data -> request_missing_info. Otherwise -> eligibility_check.",
              "on": {
                "begin": "eligibility_check",
                "missing_info": "request_missing_info"
              }
            },
            "request_missing_info": {
              "description": "Ask customer for missing required information.",
              "on_enter": "Send message requesting missing fields and provide guidance from BankFAQs.csv templates.",
              "on": {
                "info_provided": "eligibility_check",
                "timeout": "escalated_human"
              }
            },
            "eligibility_check": {
              "description": "Evaluate refund eligibility using the refunds policy and KYC status.",
              "on_enter": [
                "Consult refunds_policy.yaml to evaluate eligibility rules (eligibility, amount caps, time windows, AML/KYC blocks).",
                "Set kyc_verified and a temporary is_eligible decision and decision_notes with policy citations."
              ],
              "on": {
                "eligible": "compute_refund",
                "ineligible": "refund_denied",
                "needs_documents": "request_documents"
              }
            },
            "request_documents": {
              "description": "Request supporting documents required for eligibility (e.g., proof of transaction, ID).",
              "on_enter": "Notify customer with required document list (use BankFAQs.csv templates) and set awaiting_documents flag.",
              "on": {
                "documents_received": "eligibility_check",
                "timeout": "escalated_human"
              }
            },
            "compute_refund": {
              "description": "Compute the allowable refund amount according to policy (caps, fees, pro-rata calculations).",
              "on_enter": "Apply refund calculation rules from refunds_policy.yaml, set refund_amount, determine if approval_required.",
              "on": {
                "approval_needed": "awaiting_approval",
                "no_approval_needed": "initiate_refund"
              }
            },
            "awaiting_approval": {
              "description": "Create an approval task for a human approver and wait for decision.",
              "on_enter": "Create approval ticket (create_ticket) including decision_notes and policy citations. Notify approver.",
              "on": {
                "approval_granted": "initiate_refund",
                "approval_denied": "refund_denied",
                "timeout": "escalated_human"
              }
            },
            "initiate_refund": {
              "description": "Request refund execution via payment tool.",
              "on_enter": "Attempt to call the 'initiate_refund' tool. If tool unavailable, create ticket and escalate.",
              "action": "call_initiate_refund",
              "on": {
                "success": "refund_initiated",
                "failure": "refund_failed",
                "tool_unavailable": "escalated_human"
              }
            },
            "refund_initiated": {
              "description": "Refund successfully initiated and recorded.",
              "on_enter": "Record refund transaction id, update system status (update_ticket), and notify customer with messaging drawn from BankFAQs.csv.",
              "terminal": true,
              "on": {}
            },
            "refund_failed": {
              "description": "Automated refund attempt failed; create a retry ticket or escalate to human.",
              "on_enter": "Create support ticket (create_ticket) with failure details and offer retry logic.",
              "on": {
                "retry": "initiate_refund",
                "escalate": "escalated_human"
              }
            },
            "refund_denied": {
              "description": "Refund is denied per policy or approver decision; notify customer with reasons and policy citations.",
              "on_enter": "Send denial notice with policy citations and next steps (appeal or support contact).",
              "terminal": true,
              "on": {}
            },
            "escalated_human": {
              "description": "Case escalated to a human agent for manual resolution (complex KYC, AML flags, tool outages).",
              "on_enter": "Create detailed escalation ticket (create_ticket) and handoff to human (handoff_to_human).",
              "terminal": true,
              "on": {}
            }
          },
          "initial_state": "start"
        }
      },
      "blueprint_meta": {
        "agent_kind": "workflow_runner",
        "description": "Finite-state orchestrator for end-to-end refund handling: collects request data, evaluates eligibility against the refunds policy, requests documents if needed, computes refundable amount, routes for approval when required, initiates refund via the payment tool, and escalates to humans on failure or unresolved cases.",
        "capabilities": [
          "orchestrate_refund",
          "evaluate_policy_rules",
          "coordinate_tool_calls",
          "create_escalations",
          "maintain_workflow_state"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "verify_identity_tool",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "verify_identity"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Operator agent wrapper for the identity verification tool used to confirm KYC status prior to refund approval or initiation.",
        "capabilities": [
          "perform_kyc_checks",
          "return_verification_result",
          "cite_verification_evidence"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "refund_initiator_tool",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "initiate_refund"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Operator agent wrapper for the payment/refund execution tool that creates refund transactions in the payment system.",
        "capabilities": [
          "call_payment_api",
          "create_refund_transaction",
          "return_refund_status"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    }
  ],
  "tools": [
    {
      "id": "ticketing",
      "type": "dummy",
      "base_url": null
    }
  ],
  "plan_preview": {
    "missing_docs": [
      "<UPLOAD:refunds_procedure>",
      "<UPLOAD:payment_api_spec>",
      "<UPLOAD:operational_runbooks_for_refunds>"
    ],
    "warnings": [
      "The refunds_workflow_runner FSM references external tool actions (create_ticket, initiate_refund, verify_identity). To execute end-to-end automation, provide concrete tool specs or ensure those tools are available in the runtime mapping.",
      "No dedicated runtime guardrails agent is included because guardrails are part of the platform runtime. Ensure baseline guardrails (PII protection, no hallucinated policy claims, escalate when unsure) are configured in the runtime.",
      "The workflow will remain partially manual until the missing procedural and API specification documents are provided; provide '<UPLOAD:refunds_procedure>' and '<UPLOAD:payment_api_spec>' to move the workflow to fully automated status."
    ],
    "rationale": "Converted the existing plan into executable agent blueprints that the factory can instantiate: - Two knowledge_rag agents: one for customer-facing FAQ responses (BankFAQs + policy) and one focused on interpreting the refunds policy. - One workflow_runner that encodes the end-to-end refund FSM (eligibility check, document collection, calculation, approval, tool invocation, escalation). - Two tool_operator agents that map to runtime tools used by the workflow: identity verification and refund initiation. Missing procedural and API specification documents are listed as placeholders so the factory or integrator can upload them to enable full automation. The guardrails functionality is intentionally not emitted as an agent blueprint because policy enforcement should be applied by the runtime guardrails layer; instead a policy RAG is provided to supply citations and explanations to other agents."
  }
}