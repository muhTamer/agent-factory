{
  "version": "1.0",
  "vertical": "fintech",
  "modes": {
    "dry_run": true
  },
  "paths": {
    "base_dir": "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace",
    "policy_pack": "spec/base_policy_pack.yaml"
  },
  "agents": [
    {
      "id": "guardrails",
      "type": "guardrails",
      "config": "spec/base_policy_pack.yaml"
    },
    {
      "id": "customer_facing_rag",
      "type": "autogen",
      "blueprint": "knowledge_rag",
      "status": "ready",
      "inputs": {
        "docs": [
          "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace\\BankFAQs.csv",
          "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace\\refunds_policy.yaml"
        ]
      },
      "blueprint_meta": {
        "agent_kind": "knowledge_rag",
        "description": "First-line conversational FAQ responder that retrieves and summarizes bank FAQ content and references refund policy when relevant.",
        "capabilities": [
          "retrieve_faq_answer",
          "summarize_faq",
          "cite_policy_references",
          "handle_simple_followups",
          "detect_pii_and_mask"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "policy_qa_rag",
      "type": "autogen",
      "blueprint": "knowledge_rag",
      "status": "ready",
      "inputs": {
        "docs": [
          "C:\\Users\\mozaki\\OneDrive\\CBS\\Thesis\\agent-factory\\.workspace\\refunds_policy.yaml"
        ]
      },
      "blueprint_meta": {
        "agent_kind": "knowledge_rag",
        "description": "Policy-focused RAG that answers compliance and policy clarification questions by retrieving passages from the refunds policy.",
        "capabilities": [
          "retrieve_policy_clause",
          "explain_policy_terms",
          "identify_policy_gaps",
          "flag_policy_conflicts"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "router_v1",
      "type": "autogen",
      "blueprint": "workflow_runner",
      "status": "ready",
      "inputs": {
        "workflow_spec": {
          "id": "router_v1_spec",
          "description": "Finite-state router that classifies messages and selects the target subsystem.",
          "engine": "fsm",
          "slots": {
            "user_message": {
              "type": "string",
              "required": true,
              "description": "Raw message from the customer."
            },
            "detected_intent": {
              "type": "string",
              "required": false,
              "description": "Best-effort intent label (e.g., faq, refund, account_issue)."
            },
            "entity": {
              "type": "string",
              "required": false,
              "description": "Detected key entity (e.g., order_id, transaction_id)."
            },
            "route": {
              "type": "string",
              "required": false,
              "description": "Decided route (faq | refunds_workflow | human)."
            }
          },
          "states": {
            "start": {
              "description": "Receive message and perform classification.",
              "on_enter": "classify_intent",
              "on": {
                "classified": "route_decision"
              }
            },
            "route_decision": {
              "description": "Decide route using detected_intent and entity heuristics and policy cues.",
              "on_enter": "determine_route",
              "on": {
                "route_faq": "route_faq",
                "route_refund": "route_refund",
                "route_human": "escalate_human"
              }
            },
            "route_faq": {
              "description": "Emit instruction to invoke the FAQ responder.",
              "on_enter": "emit_route:faq",
              "terminal": true
            },
            "route_refund": {
              "description": "Emit instruction to invoke the refunds workflow.",
              "on_enter": "emit_route:refunds_workflow",
              "terminal": true
            },
            "escalate_human": {
              "description": "Emit instruction to escalate the conversation to a human agent.",
              "on_enter": "emit_route:human",
              "terminal": true
            }
          },
          "initial_state": "start"
        }
      },
      "blueprint_meta": {
        "agent_kind": "workflow_runner",
        "description": "Classifies incoming customer messages and routes them to the appropriate subsystem: FAQ responder, refunds workflow, or human escalation.",
        "capabilities": [
          "intent_classification",
          "entity_detection",
          "route_decision",
          "emit_route_event"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "refunds_workflow_v1",
      "type": "autogen",
      "blueprint": "workflow_runner",
      "status": "ready",
      "inputs": {
        "workflow_spec": {
          "id": "refunds_workflow_v1_spec",
          "description": "FSM to evaluate refund eligibility and coordinate refund processing, referencing the refunds policy for decisions.",
          "engine": "fsm",
          "slots": {
            "customer_id": {
              "type": "string",
              "required": true,
              "description": "Customer identifier used for lookups and verification."
            },
            "order_id": {
              "type": "string",
              "required": true,
              "description": "Order or transaction identifier for the refund request."
            },
            "refund_amount": {
              "type": "number",
              "required": true,
              "description": "Requested refund amount."
            },
            "refund_reason": {
              "type": "string",
              "required": true,
              "description": "Short description of why the refund is requested."
            },
            "policy_checked": {
              "type": "boolean",
              "required": false,
              "description": "Indicates whether the refunds policy eligibility check was performed."
            },
            "identity_verified": {
              "type": "boolean",
              "required": false,
              "description": "Indicates whether the customer's identity was successfully verified."
            }
          },
          "states": {
            "start": {
              "description": "Begin refund flow and validate initial inputs.",
              "on_enter": "initiate_refund_flow",
              "on": {
                "started": "assess_eligibility"
              }
            },
            "assess_eligibility": {
              "description": "Check refund eligibility against policy clauses (timing, product type, previous refunds, AML flags).",
              "on_enter": "check_policy_eligibility",
              "on": {
                "eligible": "collect_missing_info",
                "ineligible": "reject_refund"
              }
            },
            "collect_missing_info": {
              "description": "Request or verify any missing supporting data (receipts, payment method, KYC evidence).",
              "on_enter": [
                "request_additional_info"
              ],
              "on": {
                "info_provided": "verify_identity",
                "info_missing": "escalate_human"
              }
            },
            "verify_identity": {
              "description": "Verify customer identity and KYC status as required by policy.",
              "on_enter": "verify_identity",
              "on": {
                "verified": "consult_limits",
                "unverified": "reject_refund"
              }
            },
            "consult_limits": {
              "description": "Apply monetary and frequency limits from policy; determine if manual approval required.",
              "on_enter": "apply_refund_limits",
              "on": {
                "within_limits": "approve_refund",
                "exceeds_limits": "require_approval"
              }
            },
            "require_approval": {
              "description": "Create an approval ticket for manual review when policy requires escalation.",
              "on_enter": "create_ticket",
              "on": {
                "approved": "approve_refund",
                "denied": "reject_refund"
              }
            },
            "approve_refund": {
              "description": "Invoke payment system to process the refund.",
              "on_enter": "initiate_refund",
              "on": {
                "refunded": "completed",
                "refund_failed": "create_ticket_for_manual_review"
              }
            },
            "reject_refund": {
              "description": "Terminate flow and notify customer of ineligibility or failed checks.",
              "on_enter": "notify_customer_rejection",
              "terminal": true
            },
            "completed": {
              "description": "Refund successful; notify customer and close flow.",
              "on_enter": "notify_customer_success",
              "terminal": true
            },
            "create_ticket_for_manual_review": {
              "description": "Create a ticket for manual investigation of refund failure or complex cases.",
              "on_enter": "create_ticket",
              "on": {
                "ticket_created": "escalate_human"
              }
            },
            "escalate_human": {
              "description": "Handoff to a human agent for manual processing or sensitive escalations.",
              "on_enter": "handoff_to_human",
              "terminal": true
            }
          },
          "initial_state": "start"
        }
      },
      "blueprint_meta": {
        "agent_kind": "workflow_runner",
        "description": "Orchestrates refund evaluation and processing steps according to the refunds policy: eligibility check, data collection, identity verification, approval, and refund execution.",
        "capabilities": [
          "evaluate_refund_eligibility",
          "orchestrate_verifications",
          "initiate_refund_when_allowed",
          "create_approval_ticket",
          "escalate_to_human"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "tool_initiate_refund",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "initiate_refund"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Performs refund transactions through the configured payment gateway or core banking API.",
        "capabilities": [
          "call_payment_gateway",
          "confirm_refund_execution",
          "return_refund_status"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "tool_verify_identity",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "verify_identity"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Performs identity verification and KYC status checks against identity services or internal KYC data.",
        "capabilities": [
          "perform_identity_verification",
          "return_verification_result",
          "mask_or_flag_pii"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "tool_create_ticket",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "create_ticket"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Creates support or approval tickets in the customer support system for manual review or approvals.",
        "capabilities": [
          "open_ticket",
          "attach_case_metadata",
          "return_ticket_id"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    },
    {
      "id": "tool_handoff_to_human",
      "type": "autogen",
      "blueprint": "tool_operator",
      "status": "ready",
      "inputs": {
        "tool": "handoff_to_human"
      },
      "blueprint_meta": {
        "agent_kind": "tool_operator",
        "description": "Executes handoff actions to route a case or conversation to a human agent or team.",
        "capabilities": [
          "transfer_conversation",
          "attach_context_for_human",
          "confirm_handoff"
        ],
        "tools": [],
        "vertical": "fintech"
      }
    }
  ],
  "tools": [
    {
      "id": "ticketing",
      "type": "dummy",
      "base_url": null
    }
  ],
  "plan_preview": {
    "missing_docs": [
      "<UPLOAD:refunds_procedure>",
      "<UPLOAD:payment_gateway_tool_spec>",
      "<UPLOAD:core_banking_api_spec>"
    ],
    "warnings": [
      "The refunds workflow references external tools and procedural steps; provide the refunds procedure document and tool specifications to make the workflow fully executable end-to-end.",
      "Runtime guardrails (PII masking, AML/KYC enforcement) are not represented as agents here \u2014 they must be enforced by the platform runtime. Ensure the runtime enforces the baseline guardrails (No PII leakage; cite policy; escalate when unsure).",
      "The router FSM uses classification signals; include an intent-model or classification mapping document if deterministic routing rules are required."
    ],
    "rationale": "Converted the existing plan into a set of concrete, executable blueprints using only supported agent_kinds. Two RAG agents provide customer FAQ responses and policy lookups using the provided docs. A router and refunds workflow are implemented as FSM workflow_runners to make routing and multi-step refund orchestration explicit. Tool operator agents wrap the named operational tools required by the workflow (initiate_refund, verify_identity, create_ticket, handoff_to_human). Listed missing_docs reflect the procedural and tool-spec documents required to make refund execution fully operational."
  }
}